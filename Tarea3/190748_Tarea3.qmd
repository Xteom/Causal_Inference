---
title: "Tarea 3: ENIGH Salud Alimentaria"
subtitle: "Inferencia Causal"
format: pdf
author: Mateo De La Roche Macías
editor: visual
echo: false #muesta código
include: true #muesta salida
---

```{r, include=FALSE}
library(reticulate)
use_condaenv(condaenv = "itam")
#install.packages(c("plm"))
library(dplyr)
library(ggplot2)
library(RCT)
library(sandwich)
library(lmtest)
library(stargazer)
library(plm)
library(tidyr)
```

Oregon tiene actualmente una lista de espera de 90,000 personas de bajos ingresos que buscan acceder a Medicaid, pero sólo dispone de 30,000 cupos disponibles. Adicionalmente, el estado carece de datos concretos para verificar si el acceso a Medicaid realmente tiene un impacto positivo en la salud autoreportada de los beneficiarios.

Vamos a realizar un análisis sobre los efectos del acceso al seguro de salud en la salud autoreportada. Los datos que se utilizan en el análisis fueron obtenidos mediante una lotería de selección aleatoría para asignar los cupos disponibles de Medicaid.

El estado de Oregon llevó a cabo la lotería, resultando en la selección aleatoria de 29,834 individuos de una lista inicial depurada de casi 75,000 solicitantes (los otros 15,000 solicitantes no eran elegibles para el programa).

Para evaluar el impacto del programa, se organizó una serie de encuestas en tres momentos clave: antes de la implementación del programa, a los seis meses (submuestra de 5000 individuos) y a los doce meses

needmet med Xm, ,health gen bin Xm, baddays phys Xm y baddays ment Xm

```{r}
oregon_0 <- read.csv("oregon_0.csv")
oregon_6 <- read.csv("oregon_6.csv")
oregon_12 <- read.csv("oregon_12.csv")
```

## Balances

### a) Verificación de aleatoriedad al asginar los grupos de tratamiento y control en datos basales.

***Tabla de balance para para datos antes de la implementación.***

En los datos tenemos como variables basales, año de nacimiento, género, ingresos del hogar, raza, educación.

```{r}
arrange(balance_table(oregon_0, "treatment"),(p_value1))
```

La tabla anterior plantea como hipótesis nula que no hay diferencia entre los grupos de tratamiento y control. Aunque la mayoría de las variables no parecen ser diferentes, el p-value en las variables `birthyear_list`, `female_list` y `hhinc_cat_0m` son menores a 0.05 lo cual nos permite concluir con un nivel de significancia del 0.05 que hubo un sesgo en la asignación de tratamiento. Parece ser que el año de nacimiento se utilizó como variable para asignar el tratamiento y que hubo un sesgo significativo otorgandole mayor tratamiento médico a las mujeres. Lo más preocupante es que el promedio de ingresos entre ambos grupos es significativamente muy diferente por lo que podría haber habido alguna especie de resago a la población con ingresos menores.

### b) Verificación de representatividad en submuestra y después de 12 meses

***Tabla de balance para para datos después de 6 meses.***

```{r}
arrange(balance_table(oregon_6, "treatment"),(p_value1))
```

Submuestra de 6 Meses: Hay diferencias significativas en varias variables, incluidas `baddays_ment_6m`, `baddays_phys_6m`, `health_gen_bin_6m`, `ins_any_6m` y `needmet_med_6m.` Esto sugiere que la submuestra de 6 meses puede no ser representativa del balance inicial, y podría haber sesgo en la asignación de tratamiento en esta submuestra. En especial se nota una gran diferencia en la variable `ins_any_6m`, la cual indica si tenía algún tipo de seguro, se puede ver como muchas personas del tratamiento si tenían seguro en comparación con las del grupo control.

***Tabla de balance para para datos después de 12 meses.***

```{r}
arrange(balance_table(oregon_12, "treatment"),(p_value1))
```

Aquí también se puede observar un sesgo, sin embargo, se observa un sesgo parecido al que se observa en la submuestra tomada a los 6 meses, esto quiere decir que lo más probable es que los encuestadores estén introduciendo alguna especie de sesgo al momento de encuestar.

### c) Efecto en representatividad

El uso de la muestra de seis meses puede afectar la representatividad de los resultados debido a los sesgos observados. Sin embargo, dado que estos sesgos también están presentes en la muestra de doce meses, esto sugiere que el diseño del estudio y los métodos de recolección de datos están introduciendo estos sesgos de manera sistemática. Es esencial ajustar los análisis subsecuentes para estas variables sesgadas para obtener estimaciones precisas del impacto del tratamiento.

## Efecto de tratamiento simple

### a) Definición de efectos

-   **Efecto Promedio del Tratamiento (ATE)**: El ATE es la diferencia promedio en los resultados entre aquellos que recibieron el tratamiento (acceso a Medicaid) y aquellos que no lo recibieron, en la población general. En este contexto, el ATE mide el impacto promedio de tener acceso a Medicaid en la salud general autoreportada de los beneficiarios, independientemente de si realmente usaron el servicio o no.

-   **Efecto Promedio en los Tratados (TOT)**: El TOT es la diferencia promedio en los resultados entre aquellos que recibieron el tratamiento (acceso a Medicaid) y aquellos que no lo recibieron, pero solo entre los individuos que realmente utilizaron el tratamiento. En este contexto, el TOT mide el impacto promedio de tener acceso a Medicaid en la salud general autoreportada de los beneficiarios que realmente utilizaron los servicios de Medicaid.

En este caso el *policy maker* se debería de fijar en el ATE ya que no solo le importan los beneficios propios del programa, si no también el beneficio que esté tiene sobre la población total (beneficio más externalidades). El TOT le interesaría más a los médicos o a Medicaid para tener el efecto de su programa.

### b) Evaluación del efecto de tratamiento utilizando el estimador de *Neyman*

*Prueba de Hipótesis*

-   $H_0$: El tratamiento (ganar la lotería) no tiene efecto sobre los beneficiarios ($ATE = 0$)
-   $H_1$: El tratamiento (ganar la lotería) tiene un efecto en la salud autoreportada de los beneficiarios $ATE \neq 0$

Definición de $ATE$: $$
ATE = \mathbb{E}[Y^T_i] - \mathbb{E}[Y^C_i]
$$ Donde:

-   $Y^T_i$: es el resultado potencial para el individuo $i$ sí recibe el tratamiento (pertence a $T$)
-   $Y^C_i$: es el resultado potencial para el individuo $i$ si no recibe el tratamiento (pertenece a $C$)

```{r}
# Estimador de Neyman
neyman_estimator <- function(data, outcome, treatment) {
  treated <- data[data[[treatment]] == 1, ]
  control <- data[data[[treatment]] == 0, ]
  
  ate <- mean(treated[[outcome]]) - mean(control[[outcome]])
  se <- sqrt(var(treated[[outcome]])/nrow(treated) + var(control[[outcome]])/nrow(control))
  t_stat <- ate / se
  p_value <- 2 * pt(-abs(t_stat), df = nrow(data) - 2)
  
  return(list(ATE = ate, SE = se, t_stat = t_stat, p_value = p_value))
}

# Calcular el estimador de Neyman
ney_results <- neyman_estimator(oregon_12, "health_gen_bin_12m", "treatment")
ney_results
```

Efecto Promedio del Tratamiento (ATE):

-   El ATE estimado es -0.0503. Esto significa que, en promedio, el grupo de tratamiento (los que ganaron la lotería de Medicaid) tiene una probabilidad 5.03% menor de reportar buena salud general (health_gen_bin_12m) en comparación con el grupo de control (los que no ganaron la lotería de Medicaid). Este resultado sugiere que el tratamiento tuvo un efecto negativo en la salud general autoreportada de los beneficiarios.

*Nota: El signo negativo es por como está construida la definición del ATE, no debería interpretarse como un efecto negativo.*

Error Estándar (SE):

-   El error estándar del ATE es 0.00735. Por lo tanto, la estimación es precisa.

Signficancia:

-   El P-value es de 8.53e-12, por lo cual podemos aceptar con un nivel de significancia de 0.001 (o hasta menor) que el efecto del tratamiento (ganar la lotería de Medicaid) sobre la salud general autoreportada doce meses después es estadísticamente significativo.

### c) Estimación OLS simple (sin controles) errores heterocedásticos

```{r}
model_ols_simple <- lm(health_gen_bin_12m ~ treatment, data = oregon_12)
```

Ecuación estimada:

```{r}
coeficientes <- coef(model_ols_simple)
cat("health_gen_bin_12m =", coeficientes[1], "+", coeficientes[2], "* treatment\n")
```

Resultados:

```{r}
coeftest(model_ols_simple, vcov = vcovHC(model_ols_simple, type = "HC1"))
```

El coeficiente del tratamiento representa el cambio en la probabilidad de reportar buena salud general asociado con ganar la lotería de Medicaid. La estimación es -0.0503, lo que indica que, en promedio, ganar la lotería de Medicaid reduce la probabilidad de reportar buena salud general en un 5.03%. Este resultado es estadísticamente significativo al nivel del 0.001. Esto concuerda con lo obtenido en la prueba de Neyman.

### d) Estimación OLS simple (con controles) errores heterocedásticos

```{r}
# Modelo OLS con controles
model_ols_controls <- lm(health_gen_bin_12m ~ treatment + birthyear_list + female_list + hhinc_cat_12m, data = oregon_12)

# Errores heterocedásticos
coeftest(model_ols_controls, vcov = vcovHC(model_ols_controls, type = "HC1"))
```

Los controles se eligieron basándonos en las variables que tenían sesgos al hacer las tablas de balance. Al utilizarlas como control podemos reducir el efecto que tienen y obtener un mejor $ATE$.

Al controlar por las variables sesgadas, podemos ver que el coeficiente del tratamiento disminuye, esto significa que que ganar la lotería de Medicaid reduce la probabilidad de reportar buena salud general en un 4.51% (sifnificativo con un significancia muy baja menor 0.001)

Para los coeficientes de las variables control:

-   Cada año adicional de edad está asociado con una reducción de 0.74% en la probabilidad de reportar buena salud general.
-   Ser mujer no tiene un efecto significativo en la probabilidad de reportar buena salud general. (nota al profesor, si fuera un reporte quitaría las variables no significativas y volvería a correr la regresión solo con controles significativos pero para no llenar de regresiones el inciso lo dejaré con los iniciales)
-   Un aumento en la categoría de ingresos del hogar está asociado con una reducción del 1.73% en la probabilidad de reportar buena salud general.

### e) Agregando el efecto de seis meses después como control

```{r}
# Modelo OLS con controles a los seis meses
model_ols_controls_6m <- lm(health_gen_bin_6m ~ treatment + birthyear_list + female_list + hhinc_cat_6m, data = oregon_6)

# Errores heterocedásticos
coeftest(model_ols_controls_6m, vcov = vcovHC(model_ols_controls_6m, type = "HC1"))
```

Es curioso observar que en el análisis a seis meses se ve un impacto marginalmente significativo en ser mujer, aunque no es altamente significativo (p-valor = 0.0647). Esto confirma que la forma en la que se realizó la submuestra podría no haber sido correcta. Sin embargo, el efecto del tratamiento a los seis meses (-5.11%) es consistente y no es muy diferente del efecto observado a los doce meses (-4.51%), lo que sugiere una robustez en la influencia del tratamiento sobre la salud general autoreportada.

### f) Reporte de resultados

```{r results='asis'}
# Generar la tabla de resultados
stargazer(model_ols_simple, model_ols_controls, model_ols_controls_6m, 
          type = "latex",
          dep.var.labels = c("Health General (12m)", "Health General (6m)"),
          covariate.labels = c("Treatment", "Year of Birth", "Female", "Household Income"),
          out = "results.txt")
```

El tamaño del efecto encontrado (-4.51% a los 12 meses y -5.11% a los 6 meses) es relativamente pequeño pero estadísticamente significativo. Esto puede considerarse un efecto moderado en el contexto de intervenciones de salud pública, donde cambios en la percepción de salud general pueden reflejar una combinación de múltiples factores. Con los controles, la $R^2$ mejora de forma significativa, lo que quiere decir que si explica mejor los datos.

## Primeras diferencias (dos periodos de tiempo)

```{r}
merged_data <- merge(oregon_0, oregon_12, by = "person_id", suffixes = c("_0m", "_12m"))

# Calcular las diferencias en las variables de interés
merged_data <- merged_data %>%
  mutate(diff_health_gen_bin = health_gen_bin_12m - health_gen_bin_0m,
         diff_treatment = treatment_12m - treatment_0m) 
```

### a) Análisis de primeras diferencias (datos basales y doce meses después)

```{r}
# Estimar el modelo de primeras diferencias con la variable de tratamiento original
model_diff <- lm(diff_health_gen_bin ~ treatment_0m, data = merged_data)
summary(model_diff)
```

El coeficiente del tratamiento nos indica que recibir el tratamiento esta relacionado con una mejor en la salud autoreportada de un `r round(unname(coef(model_diff)["treatment_0m"])*100,2)`% en comparación al grupo control (con significancia del 0.05).

### b) Tabla de 2x2

```{r}
oregon_0 <- read.csv("oregon_0.csv")
oregon_6 <- read.csv("oregon_6.csv")
oregon_12 <- read.csv("oregon_12.csv")

# Añadir una columna de tiempo a cada dataframe
oregon_0$time <- 0
oregon_6$time <- 6
oregon_12$time <- 12

# Asegurarse de que las variables estén en el formato correcto
oregon_0$treatment <- as.factor(oregon_0$treatment)
oregon_6$treatment <- as.factor(oregon_6$treatment)
oregon_12$treatment <- as.factor(oregon_12$treatment)

oregon_0$female_list <- as.factor(oregon_0$female_list)
oregon_6$female_list <- as.factor(oregon_6$female_list)
oregon_12$female_list <- as.factor(oregon_12$female_list)

oregon_0$health_gen_bin <- oregon_0$health_gen_bin_0m
oregon_6$health_gen_bin <- oregon_6$health_gen_bin_6m
oregon_12$health_gen_bin <- oregon_12$health_gen_bin_12m

# Unir los dataframes
df_full <- bind_rows(oregon_0, oregon_6, oregon_12)
```

```{r}
# Crear la tabla de contingencia 2x2
table_2x2 <- df_full %>%
  group_by(treatment, time) %>%
  summarize(mean_health_gen_bin = mean(health_gen_bin, na.rm = TRUE))

# Filtrar solo los periodos inicial (0) y de 12 meses (12)
table_2x2_filtered <- table_2x2 %>%
  filter(time %in% c(0, 12))

# Spread para convertir en formato ancho (manteniendo solo periodos 0 y 12)
table_2x2_filtered <- table_2x2_filtered %>%
  spread(key = time, value = mean_health_gen_bin)

# Calcular el estimador de diferencias en diferencias usando la tabla filtrada
diff_in_diff_filtered = (table_2x2_filtered$`12`[2] - table_2x2_filtered$`0`[2]) - 
                        (table_2x2_filtered$`12`[1] - table_2x2_filtered$`0`[1])

# Mostrar la tabla filtrada y el valor de diferencias en diferencias
print(table_2x2_filtered)
print(diff_in_diff_filtered)

# Spread para convertir en formato ancho
table_2x2 <- table_2x2 %>%
  spread(key = time, value = mean_health_gen_bin)

```

Cuando utilizamos diferencias en diferencias simple para calcular el efecto del tratamiento, obtenemos un valor de `r round(diff_in_diff_filtered*100,2)`%, el cual es mayor que cuando calculamos el efecto utilizando el modelo de primeras diferencias, que es `r round(unname(coef(model_diff)["treatment_0m"])*100,2)`%. Esto se debe a que, al utilizar el modelo de primeras diferencias, nos fijamos solo en el efecto de las personas que estaban presentes en ambos periodos. En el modelo de diferencias en diferencias simple, se incluyen todas las observaciones disponibles, independientemente de si los individuos están presentes en ambos periodos. Es posible que en este segundo modelo tengamos más personas que recibieron el tratamiento en el grupo de doce meses después, lo que hace que el efecto real se perciba mayor.

### c) Utilizando MCO.

$$
\Delta \text{Health Gen Bin} = \beta_0 + \beta_1 \text{Treatment} + \epsilon
$$

```{r}
model_diff_mco <- lm(diff_health_gen_bin ~ treatment_0m, data = merged_data)
summary(model_diff_mco)
```

Se cumple el mismo resultado (`r round(unname(coef(model_diff_mco)["treatment_0m"])*100,2)`%).

### d) Modelo de efectos fijos

```{r}
df_full_aux <- df_full %>%
  mutate(
    Post = as.numeric(time == 12),  # Variable Post, indica el periodo posterior al tratamiento
    Treatment = as.numeric(treatment == 1),  # Variable Treatment, indica si el individuo recibió el tratamiento
    Treatment_Post = Post * Treatment  # Interacción entre Post y Treatment
  ) %>%
  filter(time %in% c(0, 12) & !is.na(health_gen_bin)) 

# Convertimos el data.frame a un pdata.frame para plm, especificando los índices
pdata_3d <- pdata.frame(df_full_aux, index = c("person_id", "time"))

# Ajustamos el modelo de efectos fijos
ef_model <- plm(health_gen_bin ~ Post + Treatment + Treatment_Post, data = pdata_3d, model = "within")

# Resumen del modelo
summary(ef_model)
```

coeficiente -0.0223241: el efecto del tratamiento en el periodo posterior es una reducción en la probabilidad de reportar una salud regular o mala en 2.23%

El coeficiente de Treatment_Post (-0.0223241) en el modelo de efectos fijos es muy similar al cambio observado en el modelo de primeras diferencias (-0.022324). Esto sugiere que el modelo de efectos fijos está capturando de manera efectiva el mismo efecto observado en el modelo de primeras diferencias. El modelo de efectos fijos controla por variables no observadas que son constantes en el tiempo, por lo tanto, parece ser que el efecto estimado no está sesgado por estas variables.

```{r}
ef_model <- plm(health_gen_bin ~ Post + Treatment + Treatment_Post, data = pdata_3d, model = "within")
summary(ef_model)

```

El coeficiente de Post indica que, en promedio, la probabilidad de reportar una salud regular o mala aumenta en 2.65% en el periodo posterior al tratamiento, independientemente de si los individuos recibieron el tratamiento. Este efecto es altamente significativo.

El coeficiente de Treatment_Post representa el efecto adicional del tratamiento en el periodo posterior. Aunque el signo es negativo, indicando una reducción en la probabilidad de reportar una salud regular o mala del 1.30%, este efecto no es estadísticamente significativo (p-valor \> 0.05).

El valor del coeficiente de Treatment_Post en el modelo de efectos fijos (-0.01297) es similar al estimador de diferencias en diferencias simple que obtuvimos anteriormente (-0.01561), lo cual es consistente dado que ambos modelos intentan capturar el efecto del tratamiento controlando por diferencias individuales.

### e) Errores heterocedásticos vs errores cluster a nivel individuo

*Errores heterocedásticos*:

```{r}
coeftest(ef_model, vcov = vcovHC(ef_model, type = "HC1"))
```

*Errores cluster*:

```{r}
coeftest(ef_model, vcov = vcovHC(ef_model, type = "HC1", cluster = "group"))
```

Al resultar iguales ambos errores quiere decir qu no hay heterocedasticidad significativa ni correlación intra-grupo que afecte los errores estándar por lo que el modelo es robusto ante los diferentes grupos de individuos.

## Primeras diferencias (tres periodos de tiempo)

### a) Primeras diferencias

```{r}
pdata_4 <- pdata.frame(df_full, index = c("person_id", "time"))

# Ajustar el modelo de primeras diferencias
pd_model <- plm(health_gen_bin ~ treatment, data = pdata_4, model = "fd")

# Resumen del modelo
summary(pd_model)
```

### b) Tabla 3x2

```{r}
# Crear la tabla de 3x2
table_3x2 <- df_full %>%
  group_by(treatment, time) %>%
  summarize(mean_health_gen_bin = mean(health_gen_bin, na.rm = TRUE)) %>%
  spread(key = time, value = mean_health_gen_bin)

# Mostrar la tabla
(table_3x2)
```

El estimador TOT se obtiene obteniendo la diferencia entre los grupos de tratamiento y control en los periodos 6 y 12.

Diferencias de medias para cada grupo:

-   Grupo Control (Tratamiento = 0):

    -   Periodo 0 a 6 meses: 0.465 - 0.393 = 0.072
    -   Periodo 0 a 12 meses: 0.439 - 0.393 = 0.046

-   Grupo Tratamiento (Tratamiento = 1):

    -   Periodo 0 a 6 meses: 0.407 - 0.369 = 0.038
    -   Periodo 0 a 12 meses: 0.389 - 0.369 = 0.020

Diferencias en diferencias (DiD) para cada periodo:

-   TOT de 6 meses:

    -   TOT = (0.407 - 0.369) - (0.465 - 0.393)
    -   TOT = 0.038 - 0.072 = -0.034

-   TOT de 12 meses:

    -   TOT = (0.389 - 0.369) - (0.439 - 0.393)
    -   TOT = 0.020 - 0.046 = -0.026

Resultados:

-   El TOT de 6 meses es -0.034.

-   El TOT de 12 meses es -0.026.

### c) MCO

```{r}
# Preparar los datos y crear las variables necesarias
df_full <- df_full %>%
  mutate(
    Post_6m = as.numeric(time == 6),  # Variable Post para 6 meses
    Post_12m = as.numeric(time == 12),  # Variable Post para 12 meses
    Treatment = as.numeric(treatment == 1),  # Variable Treatment
    Treatment_Post_6m = Post_6m * Treatment,  # Interacción Treatment y Post 6 meses
    Treatment_Post_12m = Post_12m * Treatment  # Interacción Treatment y Post 12 meses
  ) %>%
  filter(!is.na(health_gen_bin))  # Filtrar observaciones sin valores NA en health_gen_bin

# Ajustar el modelo MCO (Diferencias en Diferencias)
mco_model <- lm(health_gen_bin ~ Post_6m + Post_12m + Treatment + Treatment_Post_6m + Treatment_Post_12m, data = df_full)
summary(mco_model)
```

### d) Comparación

La comparación de los efectos estimados en los diferentes modelos muestra que el tratamiento tiene un efecto consistente en la mejora de la salud autoreportada, reduciendo la probabilidad de reportar una salud regular o mala. La adición de un tercer periodo en el modelo de primeras diferencias permite capturar cambios a corto y largo plazo, mostrando una reducción significativa en la probabilidad de reportar una salud regular o mala debido al tratamiento tanto a los seis como a los doce meses en el modelo MCO. Sin embargo, el modelo de primeras diferencias con tres periodos no logró significancia en todos los coeficientes, lo que puede deberse a la variabilidad adicional y la inclusión de más datos temporales. Además, es importante recordar que nuestros datos después de 6 meses no estaban balanceados, lo cual podría afectar los resultados de los modelos y contribuir a la falta de significancia en algunos coeficientes. Por otro lado, el modelo MCO confirmó la efectividad del tratamiento con significancia estadística en los efectos de Treatment_Post_6m y Treatment_Post_12m. La manera adecuada de comparar los efectos es observando la consistencia y significancia de los coeficientes a través de los diferentes modelos y periodos de tiempo.

### e) Efectos fijos

```{r}
pdata_4e <- pdata.frame(df_full, index = c("person_id", "time"))

ef_model_4 <- plm(health_gen_bin ~ 
                    Post_6m + Post_12m + 
                    Treatment_Post_6m + Treatment_Post_12m, 
                  data = pdata_4e, model = "within")
summary(ef_model_4)
```

### f) Errores heterocedásticos vs Errores Cluster

*Errores heterocedásticos*:

```{r}
coeftest(ef_model_4, vcov = vcovHC(ef_model_4, type = "HC1"))
```

*Errores cluster*:

```{r}
coeftest(ef_model_4, vcov = vcovHC(ef_model_4, type = "HC1", cluster = "group"))
```

Vuelven a salir iguales

\pagebreak

## Reporte

### Tabla de modelos.

```{r}
# Generar la tabla de resultados con stargazer
stargazer(
  model_ols_simple, 
  model_ols_controls, 
  ef_model_4, 
  mco_model, 
  type = "text",
  title = "Estimación del Efecto del Acceso a Medicaid sobre la Salud Autoreportada",
  dep.var.labels = c("Salud General Autoreportada"),
  covariate.labels = c("Tratamiento", "Año de Nacimiento", "Mujer", "Ingreso del Hogar", "Post 6m", "Post 12m", "Tratamiento * Post 6m", "Tratamiento * Post 12m"),
  no.space = TRUE,
  omit.stat = c("f", "ser")
)

```

### Reporte

#### Antecedentes:

Oregon tiene actualmente una lista de espera de 90,000 personas de bajos ingresos que buscan acceder a Medicaid, pero solo dispone de 30,000 cupos disponibles. Ante esta situación, se implementó una lotería para asignar los cupos disponibles de manera aleatoria, lo que permitió evaluar el impacto del acceso a Medicaid sobre la salud autoreportada de los beneficiarios.

#### Metodología:

Se realizaron encuestas en tres momentos clave: antes de la implementación del programa, a los seis meses (submuestra de 5000 individuos) y a los doce meses. Utilizando estos datos, se aplicaron varias técnicas econométricas para estimar el impacto del tratamiento, incluyendo modelos de regresión OLS, modelos de diferencias en diferencias (DiD) y modelos de efectos fijos. Los análisis se realizaron con y sin controles relevantes para asegurar la robustez de los resultados.

#### Resultados Principales:

1. **Desbalance Inicial:**
   - Los análisis de balance inicial mostraron diferencias significativas en variables como el año de nacimiento, el género y los ingresos del hogar entre los grupos de tratamiento y control. Estos desbalances pueden introducir sesgos que deben ser controlados en los modelos de regresión subsecuentes.

2. **Estimación OLS Simple:**
   - La estimación OLS sin controles mostró que ganar la lotería de Medicaid reduce la probabilidad de reportar una salud regular o mala en un 5.03% (p < 0.01). Este resultado es significativo y sugiere un impacto positivo del acceso a Medicaid en la salud autoreportada.

3. **Estimación OLS con Controles:**
   - Al incluir controles como el año de nacimiento, género e ingresos del hogar, el efecto del tratamiento se redujo a una disminución del 4.51% en la probabilidad de reportar una salud regular o mala (p < 0.01). Este ajuste subraya la importancia de controlar por variables basales desbalanceadas para obtener estimaciones más precisas del efecto del tratamiento.

4. **Modelos de Primeras Diferencias y Efectos Fijos:**
   - Los modelos de primeras diferencias, tanto con dos como con tres periodos, y los modelos de efectos fijos sugieren que el efecto del tratamiento es consistente y significativo a largo plazo. En particular, el modelo de efectos fijos con tres periodos mostró que el tratamiento reduce la probabilidad de reportar una salud regular o mala en un 2.23% a los doce meses (p < 0.05). Sin embargo, el modelo no mostró un efecto significativo a los seis meses, lo que podría deberse a desbalances en los datos de este periodo.

5. **Diferencias en Diferencias (DiD):**
   - Los modelos de DiD mostraron un efecto consistente del tratamiento en la mejora de la salud autoreportada. El análisis indicó una reducción del 2.65% en la probabilidad de reportar una salud regular o mala a los doce meses (p < 0.01). La inclusión de un tercer periodo en el análisis de DiD permitió capturar mejor los efectos a corto y largo plazo del tratamiento.

#### Reflexión Final:

La comparación de los diferentes modelos y métodos de estimación destacó varias consideraciones importantes:

- **Robustez y Significancia:** Aunque los diferentes modelos presentaron tamaños de efecto ligeramente diferentes, todos mostraron un impacto significativo y consistente del acceso a Medicaid en la salud autoreportada de los beneficiarios. La robustez de los resultados fue confirmada a través de varios métodos econométricos.
  
- **Importancia del Control de Variables Basales:** El ajuste por variables desbalanceadas como el año de nacimiento, género e ingresos del hogar es crucial para obtener estimaciones precisas del efecto del tratamiento. Los desbalances iniciales pueden introducir sesgos que afecten la interpretación de los resultados.


Estos resultados proporcionan una base sólida para argumentar que el acceso a Medicaid tiene un impacto positivo en la salud de las poblaciones vulnerables, lo cual es crucial para los formuladores de políticas. La evidencia obtenida puede informar decisiones políticas y prácticas en contextos similares, destacando la importancia de programas de salud pública como Medicaid.